<!DOCTYPE html>
<html lang="zh-TW" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="Ryan Project Hub - å°ˆæ¡ˆç®¡ç†èˆ‡ç›£æ§ä¸­å¿ƒ">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
  <title>Ryan Project Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#020617' },
            indigo: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' }
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; }
    .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
    .glass-light { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    .animate-delay-1 { animation-delay: 0.1s; }
    .animate-delay-2 { animation-delay: 0.2s; }
    .animate-delay-3 { animation-delay: 0.3s; }
    .animate-delay-4 { animation-delay: 0.4s; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    [data-theme="light"] body { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); }
    [data-theme="light"] .glass { background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(0, 0, 0, 0.08); }
    .hover-lift { transition: all 0.2s ease; }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.3); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .status-online { background: #10b981; box-shadow: 0 0 8px #10b981; }
    .status-offline { background: #ef4444; }
    .status-checking { background: #f59e0b; animation: pulse 1s infinite; }
    .status-dev { background: #8b5cf6; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .filter-btn.active { background: rgba(99, 102, 241, 0.3); border-color: #6366f1; }
    .heatmap-cell { width: 12px; height: 12px; border-radius: 2px; }
    .heatmap-l0 { background: rgba(99, 102, 241, 0.1); }
    .heatmap-l1 { background: rgba(99, 102, 241, 0.3); }
    .heatmap-l2 { background: rgba(99, 102, 241, 0.5); }
    .heatmap-l3 { background: rgba(99, 102, 241, 0.7); }
    .heatmap-l4 { background: rgba(99, 102, 241, 1); }
    .dep-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; }
    .dep-ok { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .dep-new { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .progress-bar { height: 4px; border-radius: 2px; background: rgba(255,255,255,0.1); overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 2px; transition: width 0.3s ease; }
    .card-clickable { cursor: pointer; }
    .card-clickable:hover { border-color: rgba(99, 102, 241, 0.5); }
    .price-up { color: #10b981; }
    .price-down { color: #ef4444; }
    .weather-icon { font-size: 1.5rem; }
    .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .pulse-ring { animation: pulse-ring 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse-ring { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  </style>
</head>
<body class="text-slate-300">
  <div class="max-w-7xl mx-auto px-4 py-6">
    
    <!-- Header with Status Overview -->
    <header class="glass rounded-2xl px-6 py-4 mb-6 animate-fade-in">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h1 class="text-2xl font-bold text-white tracking-tight">
            <i class="fas fa-chart-line text-indigo-400 mr-2"></i>Ryan <span class="text-indigo-400">Project Hub</span>
          </h1>
          <p class="text-slate-400 mt-1 text-sm">å°ˆæ¡ˆç®¡ç†èˆ‡æ´»å‹•ç›£æ§ä¸­å¿ƒ</p>
        </div>
        
        <!-- Status Overview Bar -->
        <div class="flex items-center gap-4 flex-wrap">
          <div class="flex items-center gap-2 glass-light px-3 py-2 rounded-xl">
            <span class="status-dot status-online" id="globalStatus"></span>
            <span class="text-sm text-white" id="systemStatus">ç³»çµ±æ­£å¸¸</span>
          </div>
          <div class="flex items-center gap-2 glass-light px-3 py-2 rounded-xl">
            <i class="fas fa-robot text-indigo-400"></i>
            <span class="text-sm text-white"><span id="agentCount">3</span> Agents æ´»èº</span>
          </div>
          <div class="flex items-center gap-2 glass-light px-3 py-2 rounded-xl">
            <i class="fas fa-clock text-amber-400"></i>
            <span class="text-sm text-white"><span id="cronJobCount">6</span> æ’ç¨‹ä»»å‹™</span>
          </div>
          <div class="flex items-center gap-3">
            <button onclick="openFeedback()" class="glass px-3 py-2 rounded-xl hover-lift text-white" title="ç™¼é€åé¥‹">
              <i class="fas fa-comment-dots"></i>
            </button>
            <button id="themeBtn" onclick="toggleTheme()" class="glass px-3 py-2 rounded-xl hover-lift text-lg">ğŸŒ™</button>
            <button onclick="refreshAll()" class="glass px-3 py-2 rounded-xl hover-lift text-white" title="é‡æ–°æ•´ç†">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Time Display -->
      <div class="flex items-center gap-4 mt-4 pt-4 border-t border-slate-700/50">
        <div class="flex items-center gap-2">
          <i class="fas fa-clock text-slate-400"></i>
          <span class="text-xl font-semibold text-white" id="clock">--:--:--</span>
        </div>
        <div class="flex items-center gap-2">
          <i class="fas fa-calendar text-slate-400"></i>
          <span class="text-sm text-white" id="fullDate">--</span>
        </div>
        <div class="flex items-center gap-2">
          <i class="fas fa-moon text-slate-400"></i>
          <span class="text-sm text-white" id="lunarDate">--</span>
        </div>
      </div>
    </header>
    
    <!-- Quick Stats Row -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="glass rounded-xl p-4 animate-fade-in">
        <div class="flex items-center gap-2 mb-2">
          <i class="fas fa-folder text-green-400"></i>
          <span class="text-xs text-slate-400">å°ˆæ¡ˆç¸½æ•¸</span>
        </div>
        <div class="text-2xl font-bold text-white" id="projectCount">0</div>
        <div class="text-xs text-slate-500"><span id="activeCount">0</span> é€²è¡Œä¸­</div>
      </div>
      <div class="glass rounded-xl p-4 animate-fade-in">
        <div class="flex items-center gap-2 mb-2">
          <i class="fas fa-globe text-amber-400"></i>
          <span class="text-xs text-slate-400">ä¸Šç·šç¶²ç«™</span>
        </div>
        <div class="text-2xl font-bold text-white" id="siteCount">0</div>
        <div class="text-xs text-slate-500">sites</div>
      </div>
      <div class="glass rounded-xl p-4 animate-fade-in">
        <div class="flex items-center gap-2 mb-2">
          <i class="fas fa-bolt text-indigo-400"></i>
          <span class="text-xs text-slate-400">æœ¬é€±æ´»èº</span>
        </div>
        <div class="text-2xl font-bold text-white" id="weekActive">14</div>
        <div class="text-xs text-slate-500">å°æ™‚</div>
      </div>
      <div class="glass rounded-xl p-4 animate-fade-in">
        <div class="flex items-center gap-2 mb-2">
          <i class="fas fa-star text-purple-400"></i>
          <span class="text-xs text-slate-400">å“è³ªåˆ†æ•¸</span>
        </div>
        <div class="text-2xl font-bold text-white" id="qualityScore">95</div>
        <div class="text-xs text-slate-500">/ 100</div>
      </div>
    </div>
    
    <!-- Info Cards Row - Enhanced -->
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
      <!-- Weather -->
      <div class="glass rounded-xl p-4 animate-fade-in animate-delay-1 card-clickable" onclick="openWeatherDetail()">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-slate-400">ğŸŒ¤ï¸ é«˜é›„</span>
          <i class="fas fa-external-link-alt text-xs text-slate-500"></i>
        </div>
        <div class="flex items-center gap-2">
          <span class="weather-icon" id="weatherIcon">â›…</span>
          <div>
            <div class="text-2xl font-semibold text-white" id="weather-temp">--Â°C</div>
            <div class="text-xs text-slate-400" id="weather-desc">è¼‰å…¥ä¸­...</div>
          </div>
        </div>
      </div>
      
      <!-- Bitcoin -->
      <div class="glass rounded-xl p-4 animate-fade-in animate-delay-1 card-clickable" onclick="openCryptoDetail()">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-slate-400">â‚¿ æ¯”ç‰¹å¹£</span>
          <i class="fas fa-external-link-alt text-xs text-slate-500"></i>
        </div>
        <div class="text-xl font-semibold text-white" id="crypto-btc">$---</div>
        <div class="text-xs mt-1" id="crypto-change">--</div>
      </div>
      
      <!-- Telegram Groups -->
      <div class="glass rounded-xl p-4 animate-fade-in animate-delay-1">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-slate-400">ğŸ’¬ Telegram</span>
        </div>
        <div class="text-2xl font-semibold text-white" id="tgGroupCount">0</div>
        <div class="text-xs text-slate-400 mt-1">ç¾¤çµ„</div>
      </div>
      
      <!-- OpenClaw Status -->
      <div class="glass rounded-xl p-4 animate-fade-in animate-delay-1 card-clickable" onclick="openOpenClawStatus()">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-slate-400">ğŸ¦¾ OpenClaw</span>
          <span class="status-dot status-online" id="openclawStatusDot"></span>
        </div>
        <div class="text-lg font-semibold text-white" id="openclawStatus">è¼‰å…¥ä¸­</div>
        <div class="text-xs text-slate-400 mt-1" id="openclawAgents">-- agents</div>
      </div>
      
      <!-- System Load -->
      <div class="glass rounded-xl p-4 animate-fade-in animate-delay-1 card-clickable" onclick="openSystemDetail()">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-slate-400">ğŸ’» ç³»çµ±</span>
          <i class="fas fa-chart-bar text-xs text-slate-500"></i>
        </div>
        <div class="flex items-center gap-2">
          <div class="flex-1">
            <div class="text-sm font-semibold text-white" id="cpuDisplay">--%</div>
            <div class="progress-bar mt-1">
              <div class="progress-fill bg-green-500" id="cpuBar" style="width: 0%"></div>
            </div>
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold text-white" id="memDisplay">--%</div>
            <div class="progress-bar mt-1">
              <div class="progress-fill bg-blue-500" id="memBar" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- System Status -->
    <div class="glass rounded-2xl p-5 mb-6 animate-fade-in animate-delay-2">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white"><i class="fas fa-globe text-indigo-400 mr-2"></i>ç¶²ç«™ç‹€æ…‹</h3>
        <button onclick="checkAllStatus()" class="text-xs text-slate-400 hover:text-white"><i class="fas fa-sync-alt mr-1"></i>é‡æ–°æ•´ç†</button>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="siteStatus">
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-white">Aquarium Studio</span>
            <span class="status-dot status-online"></span>
          </div>
          <div class="text-xs text-green-400">ğŸŸ¢ ç·šä¸Š</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-white">RYANç”Ÿæ´»é»‘å®¢</span>
            <span class="status-dot status-online"></span>
          </div>
          <div class="text-xs text-green-400">ğŸŸ¢ ç·šä¸Š</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-white">Dashboard</span>
            <span class="status-dot status-online"></span>
          </div>
          <div class="text-xs text-green-400">ğŸŸ¢ ç·šä¸Š</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-white">SEO Blog</span>
            <span class="status-dot status-online"></span>
          </div>
          <div class="text-xs text-green-400">ğŸŸ¢ ç·šä¸Š</div>
        </div>
      </div>
    </div>
    
    <!-- Gemini API Usage Monitor -->
    <div class="glass rounded-2xl p-5 mb-6 animate-fade-in animate-delay-2">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white"><i class="fas fa-chart-bar text-emerald-400 mr-2"></i>Gemini API ç”¨é‡ç›£æ§</h3>
        <span class="text-xs text-slate-400" id="geminiDate">-</span>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <!-- ç¸½è«‹æ±‚ -->
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-slate-400">ğŸ“¤ ç¸½è«‹æ±‚æ•¸</span>
            <span class="text-xs font-mono" id="geminiRpdStatus">-</span>
          </div>
          <div class="text-xl font-bold text-white"><span id="geminiRpd">0</span> <span class="text-xs text-slate-500">/ <span id="geminiRpdLimit">500</span></span></div>
          <div class="w-full bg-slate-700 rounded-full h-1.5 mt-2">
            <div class="bg-emerald-400 h-1.5 rounded-full transition-all" id="geminiRpdBar" style="width: 0%"></div>
          </div>
        </div>
        <!-- åœ–ç‰‡ç”Ÿæˆ -->
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-slate-400">ğŸ–¼ï¸ åœ–ç‰‡ç”Ÿæˆ</span>
            <span class="text-xs font-mono" id="geminiImgStatus">-</span>
          </div>
          <div class="text-xl font-bold text-white"><span id="geminiImg">0</span> <span class="text-xs text-slate-500">/ <span id="geminiImgLimit">50</span></span></div>
          <div class="w-full bg-slate-700 rounded-full h-1.5 mt-2">
            <div class="bg-blue-400 h-1.5 rounded-full transition-all" id="geminiImgBar" style="width: 0%"></div>
          </div>
        </div>
        <!-- æ–‡å­—è«‹æ±‚ -->
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-slate-400">ğŸ’¬ æ–‡å­—è«‹æ±‚</span>
          </div>
          <div class="text-xl font-bold text-white" id="geminiText">0</div>
          <div class="text-xs text-slate-500 mt-1">ä»Šæ—¥</div>
        </div>
        <!-- éŒ¯èª¤ -->
        <div class="glass-light rounded-xl p-3">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-slate-400">âŒ éŒ¯èª¤æ¬¡æ•¸</span>
          </div>
          <div class="text-xl font-bold" id="geminiErrors"><span class="text-white">0</span></div>
          <div class="text-xs text-slate-500 mt-1">ä»Šæ—¥</div>
        </div>
      </div>
      <!-- 7 å¤©æ­·å² -->
      <div class="mt-4">
        <div class="text-xs text-slate-400 mb-2">ğŸ“Š è¿‘ 7 å¤©ç”¨é‡</div>
        <div class="flex items-end gap-1 h-16" id="geminiHistory">
          <div class="text-xs text-slate-500 w-full text-center">è¼‰å…¥ä¸­...</div>
        </div>
      </div>
    </div>
    
    <!-- Project List Table -->
    <div class="glass rounded-2xl p-5 mb-6 animate-fade-in animate-delay-2">
      <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-folder text-indigo-400 mr-2"></i>å°ˆæ¡ˆåˆ—è¡¨ (9)</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-slate-400 text-left border-b border-slate-700">
              <th class="pb-2 pr-4">#</th>
              <th class="pb-2 pr-4">åç¨±</th>
              <th class="pb-2 pr-4">ç‹€æ…‹</th>
              <th class="pb-2">è³‡æ–™å¤¾</th>
            </tr>
          </thead>
          <tbody class="text-white" id="projectTable">
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">1</td><td>Aquarium Studio</td><td><span class="text-green-400">âœ… active</span></td><td class="text-slate-400">project_shared</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">2</td><td>RYANç”Ÿæ´»é»‘å®¢</td><td><span class="text-green-400">âœ… active</span></td><td class="text-slate-400">seo-blog-next</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">3</td><td>åœ˜éšŠå”ä½œ</td><td><span class="text-green-400">âœ… active</span></td><td class="text-slate-400">team_collab</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">4</td><td>Project Dashboard</td><td><span class="text-green-400">âœ… active</span></td><td class="text-slate-400">vercel-dashboard</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">5</td><td>å­”é›€é­šç™¾ç§‘</td><td><span class="text-amber-400">ğŸ”§ dev</span></td><td class="text-slate-400">guppy_encyclopedia</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">6</td><td>GuppyGenetics</td><td><span class="text-amber-400">ğŸ”§ dev</span></td><td class="text-slate-400">GuppyGenetics</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">7</td><td>ETF Monitor</td><td><span class="text-amber-400">ğŸ”§ dev</span></td><td class="text-slate-400">ETF-Monitor</td></tr>
            <tr class="border-b border-slate-800"><td class="py-2 pr-4">8</td><td>Agent Monitor</td><td><span class="text-amber-400">ğŸ”§ dev</span></td><td class="text-slate-400">agent-monitor</td></tr>
            <tr><td class="py-2 pr-4">9</td><td>ç‘å®‰æ°´æ—ç¶²ç«™</td><td><span class="text-amber-400">ğŸ”§ dev</span></td><td class="text-slate-400">ç‘å®‰æ°´æ—ç¶²ç«™</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Agent Status - Clickable -->
    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <!-- Mars -->
      <div class="glass rounded-xl p-5 animate-fade-in animate-delay-3 card-clickable" onclick="openAgentDetail('mars')">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-amber-500 flex items-center justify-center text-white font-bold">M</div>
            <div>
              <h3 class="font-semibold text-white">Mars</h3>
              <p class="text-xs text-slate-400">Architect</p>
            </div>
          </div>
          <span class="status-dot status-online"></span>
        </div>
        <div class="text-xs text-slate-400">Gemini 3 Pro</div>
        <div class="mt-2 text-xs text-indigo-400"><i class="fas fa-external-link-alt mr-1"></i>é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
      </div>
      
      <!-- Sarah -->
      <div class="glass rounded-xl p-5 animate-fade-in animate-delay-3 card-clickable" onclick="openAgentDetail('sarah')">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-400 to-blue-500 flex items-center justify-center text-white font-bold">S</div>
            <div>
              <h3 class="font-semibold text-white">Sarah</h3>
              <p class="text-xs text-slate-400">PM</p>
            </div>
          </div>
          <span class="status-dot status-online"></span>
        </div>
        <div class="text-xs text-slate-400">MiniMax M2.5</div>
        <div class="mt-2 text-xs text-indigo-400"><i class="fas fa-external-link-alt mr-1"></i>é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
      </div>

      <!-- Ryan -->
      <div class="glass rounded-xl p-5 animate-fade-in animate-delay-3 card-clickable" onclick="openAgentDetail('ryan')">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold">R</div>
            <div>
              <h3 class="font-semibold text-white">Ryan</h3>
              <p class="text-xs text-slate-400">Lead Engineer</p>
            </div>
          </div>
          <span class="status-dot status-online"></span>
        </div>
        <div class="text-xs text-slate-400">Claude Opus</div>
        <div class="mt-2 text-xs text-indigo-400"><i class="fas fa-external-link-alt mr-1"></i>é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
      </div>
    </div>
    
    <!-- Scheduled Jobs -->
    <div class="glass rounded-2xl p-5 mb-6 animate-fade-in">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white"><i class="fas fa-clock text-indigo-400 mr-2"></i>æ’ç¨‹ä»»å‹™ (6)</h3>
        <button onclick="refreshJobs()" class="text-xs text-slate-400 hover:text-white"><i class="fas fa-sync-alt mr-1"></i>é‡æ–°æ•´ç†</button>
      </div>
      <div class="space-y-3" id="scheduledJobs">
        <!-- Job 1: æ¯æ—¥ Agent æ¸…ç† -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center text-white text-sm font-bold">ğŸ”§</div>
              <div>
                <div class="font-medium text-white">æ¯æ—¥ Agent æ¸…ç†</div>
                <div class="text-xs text-slate-400">æ¯æ—¥ 03:00 â€¢ main</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: 03:00</div>
            </div>
          </div>
        </div>
        <!-- Job 2: Gateway Restart -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white text-sm font-bold">âš¡</div>
              <div>
                <div class="font-medium text-white">OpenClaw Gateway Restart</div>
                <div class="text-xs text-slate-400">æ¯ 5 å°æ™‚ â€¢ sarah_agent</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: ~23:00</div>
            </div>
          </div>
        </div>
        <!-- Job 3: SEO Automation -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center text-white text-sm font-bold">ğŸ“</div>
              <div>
                <div class="font-medium text-white">SEO Daily Automation</div>
                <div class="text-xs text-slate-400">æ¯æ—¥ 06:00 â€¢ sarah_agent</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: 06:00</div>
            </div>
          </div>
        </div>
        <!-- Job 4: Agent é€²åº¦å ±å‘Š -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-white text-sm font-bold">ğŸ“Š</div>
              <div>
                <div class="font-medium text-white">æ¯æ—¥ Agent é€²åº¦å ±å‘Š</div>
                <div class="text-xs text-slate-400">æ¯æ—¥ 08:00 â€¢ main</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: 08:00</div>
            </div>
          </div>
        </div>
        <!-- Job 5: Telegram Summary -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-400 to-pink-500 flex items-center justify-center text-white text-sm font-bold">ğŸ’¬</div>
              <div>
                <div class="font-medium text-white">Telegram Group Summary</div>
                <div class="text-xs text-slate-400">æ¯æ—¥ 09:00 â€¢ ryan_agent</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: 09:00</div>
            </div>
          </div>
        </div>
        <!-- Job 6: Token Monitor -->
        <div class="glass-light rounded-xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center text-white text-sm font-bold">ğŸ”</div>
              <div>
                <div class="font-medium text-white">Token ä½¿ç”¨ç›£æ§</div>
                <div class="text-xs text-slate-400">æ¯å°æ™‚ â€¢ ryan_agent</div>
              </div>
            </div>
            <div class="text-right">
              <span class="status-dot status-online"></span>
              <div class="text-xs text-green-400 mt-1">ä¸‹æ¬¡: æ¯å°æ™‚</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Weekly Schedule -->
    <div class="glass rounded-2xl p-5 mb-6 animate-fade-in">
      <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-calendar-week text-indigo-400 mr-2"></i>æ¯é€±æ’ç¨‹</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-xs">
          <thead>
            <tr class="text-slate-400 border-b border-slate-700">
              <th class="pb-2 text-left">æ™‚é–“</th>
              <th class="pb-2 text-center">é€±ä¸€</th>
              <th class="pb-2 text-center">é€±äºŒ</th>
              <th class="pb-2 text-center">é€±ä¸‰</th>
              <th class="pb-2 text-center">é€±å››</th>
              <th class="pb-2 text-center">é€±äº”</th>
              <th class="pb-2 text-center">é€±å…­</th>
              <th class="pb-2 text-center">é€±æ—¥</th>
            </tr>
          </thead>
          <tbody class="text-white">
            <tr class="border-b border-slate-800">
              <td class="py-2 pr-2 text-slate-400">03:00</td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
              <td class="py-2 text-center"><span class="bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded">æ¸…ç†</span></td>
            </tr>
            <tr class="border-b border-slate-800">
              <td class="py-2 pr-2 text-slate-400">06:00</td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
              <td class="py-2 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">SEO</span></td>
            </tr>
            <tr class="border-b border-slate-800">
              <td class="py-2 pr-2 text-slate-400">08:00</td>
              <td class="py-2 text-center"><span class="bg-amber-500/20 text-amber-400 px-2 py-1 rounded">é€²åº¦</span></td>
              <td class="py-2 text-center"><span class="bg-amber-500/20 text-amber-400 px-2 py-1 rounded">é€²åº¦</span></td>
              <td class="py-2 text-center"><span class="bg-amber-500/20 text-amber-400 px-2 py-1 rounded">é€²åº¦</span></td>
              <td class="py-2 text-center"><span class="bg-amber-500/20 text-amber-400 px-2 py-1 rounded">é€²åº¦</span></td>
              <td class="py-2 text-center"><span class="bg-amber-500/20 text-amber-400 px-2 py-1 rounded">é€²åº¦</span></td>
              <td class="py-2 text-center"><span class="bg-slate-600/20 text-slate-500 px-2 py-1 rounded">-</span></td>
              <td class="py-2 text-center"><span class="bg-slate-600/20 text-slate-500 px-2 py-1 rounded">-</span></td>
            </tr>
            <tr class="border-b border-slate-800">
              <td class="py-2 pr-2 text-slate-400">09:00</td>
              <td class="py-2 text-center"><span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">TGæ‘˜è¦</span></td>
              <td class="py-2 text-center"><span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">TGæ‘˜è¦</span></td>
              <td class="py-2 text-center"><span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">TGæ‘˜è¦</span></td>
              <td class="py-2 text-center"><span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">TGæ‘˜è¦</span></td>
              <td class="py-2 text-center"><span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">TGæ‘˜è¦</span></td>
              <td class="py-2 text-center"><span class="bg-slate-600/20 text-slate-500 px-2 py-1 rounded">-</span></td>
              <td class="py-2 text-center"><span class="bg-slate-600/20 text-slate-500 px-2 py-1 rounded">-</span></td>
            </tr>
            <tr>
              <td class="py-2 pr-2 text-slate-400">æ¯5å°æ™‚</td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
              <td class="py-2 text-center"><span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">Gateway</span></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="mt-4 flex flex-wrap gap-3 text-xs">
        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-cyan-500 rounded-full"></span> æ¸…ç†: æ¯æ—¥ Agent æ¸…ç†</span>
        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-green-500 rounded-full"></span> SEO: SEO Daily Automation</span>
        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-amber-500 rounded-full"></span> é€²åº¦: æ¯æ—¥ Agent é€²åº¦å ±å‘Š</span>
        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-purple-500 rounded-full"></span> TG: Telegram Group Summary</span>
        <span class="flex items-center gap-1"><span class="w-2 h-2 bg-indigo-500 rounded-full"></span> Gateway: OpenClaw Gateway Restart</span>
      </div>
    </div>
    
    <!-- System Info -->
    <div class="glass rounded-2xl p-5 animate-fade-in">
      <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-cog text-indigo-400 mr-2"></i>ç³»çµ±è³‡è¨Š</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="glass-light rounded-xl p-3">
          <div class="text-xs text-slate-400 mb-1"><i class="fas fa-server mr-1"></i>Gateway</div>
          <div class="text-sm font-medium text-emerald-400">localhost:18789</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="text-xs text-slate-400 mb-1"><i class="fas fa-clock mr-1"></i>æ™‚å€</div>
          <div class="text-sm font-medium text-white">Asia/Taipei</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="text-xs text-slate-400 mb-1"><i class="fas fa-code mr-1"></i>Node</div>
          <div class="text-sm font-medium text-white">v25.5.0</div>
        </div>
        <div class="glass-light rounded-xl p-3">
          <div class="text-xs text-slate-400 mb-1"><i class="fas fa-tag mr-1"></i>ç‰ˆæœ¬</div>
          <div class="text-sm font-medium text-white" id="configVer">v1.0</div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="text-center py-6 text-slate-500 text-xs">
      <div class="flex items-center justify-center gap-4">
        <span>æœ€å¾Œæ›´æ–°: <span id="lastUpdate">--</span></span>
        <span class="text-slate-600">|</span>
        <span>å°ˆæ¡ˆ: <span id="projectCountFooter">0</span></span>
        <span class="text-slate-600">|</span>
        <span class="flex items-center gap-1">
          <i class="fas fa-tag text-indigo-400"></i>
          <span id="versionFooter">v1.2</span>
        </span>
      </div>
    </footer>
  </div>
  
  <!-- Command Palette Modal -->
  <div id="commandModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
    <div class="glass rounded-2xl p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold text-white mb-4"><i class="fas fa-paper-plane mr-2"></i>ç™¼é€è¨Šæ¯</h3>
      <select id="agentSelect" class="w-full glass-light rounded-xl px-4 py-2 text-white mb-3">
        <option value="mars">ğŸ—ï¸ Mars - Architect</option>
        <option value="sarah">ğŸ“‹ Sarah - PM</option>
        <option value="ryan">ğŸ’» Ryan - Lead Engineer</option>
      </select>
      <textarea id="messageInput" class="w-full glass-light rounded-xl px-4 py-2 text-white mb-3 h-24" placeholder="è¼¸å…¥è¨Šæ¯..."></textarea>
      <div class="flex gap-2">
        <button onclick="sendMessage()" class="flex-1 glass bg-indigo-500/30 px-4 py-2 rounded-xl text-white font-medium hover-lift">ç™¼é€</button>
        <button onclick="closeCommandPalette()" class="glass px-4 py-2 rounded-xl text-slate-400 hover-lift">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
  
  <!-- Task Modal removed -->
  
  <!-- Agent Detail Modal -->
  <div id="agentModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
    <div class="glass rounded-2xl p-6 w-full max-w-lg">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white" id="agentModalTitle">Agent è©³æƒ…</h3>
        <button onclick="closeAgentModal()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
      </div>
      <div class="space-y-4" id="agentModalContent">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>
  
  <!-- Feedback Modal -->
  <div id="feedbackModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
    <div class="glass rounded-2xl p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white"><i class="fas fa-comment-dots text-indigo-400 mr-2"></i>ç™¼é€åé¥‹</h3>
        <button onclick="closeFeedback()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
      </div>
      <div class="space-y-4">
        <div>
          <label class="text-xs text-slate-400">åé¥‹é¡å‹</label>
          <select id="feedbackType" class="w-full glass-light rounded-xl px-4 py-2 text-white mt-1">
            <option value="bug">ğŸ› å ±å‘Šå•é¡Œ</option>
            <option value="feature">ğŸ’¡ åŠŸèƒ½å»ºè­°</option>
            <option value="ui">ğŸ¨ ä»‹é¢æ”¹å–„</option>
            <option value="other">ğŸ’¬ å…¶ä»–</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-400">æè¿°</label>
          <textarea id="feedbackText" class="w-full glass-light rounded-xl px-4 py-2 text-white mt-1 h-32" placeholder="æè¿°æ‚¨çš„å•é¡Œæˆ–å»ºè­°..."></textarea>
        </div>
        <div class="flex gap-2">
          <button onclick="submitFeedback()" class="flex-1 glass bg-indigo-500/30 px-4 py-2 rounded-xl text-white font-medium hover-lift">ç™¼é€åé¥‹</button>
          <button onclick="closeFeedback()" class="glass px-4 py-2 rounded-xl text-slate-400 hover-lift">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Update Notification -->
  <div id="updateToast" class="fixed bottom-4 right-4 glass bg-indigo-500/30 border border-indigo-500/50 rounded-xl p-4 hidden z-50">
    <div class="flex items-center gap-3">
      <i class="fas fa-download text-indigo-400"></i>
      <div>
        <div class="text-white font-medium">æ–°ç‰ˆæœ¬å¯ç”¨</div>
        <div class="text-xs text-slate-400">v1.2 å·²ç™¼å¸ƒï¼Œé»æ“Šæ›´æ–°</div>
      </div>
      <button onclick="dismissUpdate()" class="ml-2 text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
    </div>
  </div>

  <script>
    let projects = [];
    let dashData = {};
    let currentFilter = 'all';
    let currentTaskId = null;
    
    // Load all data from dashboard-data.json (generated at build time)
    async function loadConfig() {
      try {
        const res = await fetch('/dashboard-data.json?t=' + Date.now());
        dashData = await res.json();
        projects = dashData.projects || [];
        
        // Update counts
        const activeProjects = projects.filter(p => p.status === 'active');
        document.getElementById('projectCount').textContent = projects.length;
        document.getElementById('projectCountFooter').textContent = projects.length;
        document.getElementById('activeCount').textContent = activeProjects.length;
        
        // Task stats removed
        
        // Site count
        document.getElementById('siteCount').textContent = (dashData.sites || []).length;
        // Cron job count
        document.getElementById('cronJobCount').textContent = (dashData.cronJobs || []).length;
        
        // System info from snapshot
        if (dashData.system) {
          const sys = dashData.system;
          const cpu = parseFloat(sys.cpu) || 0;
          const mem = parseFloat(sys.memoryPercent) || 0;
          document.getElementById('cpuDisplay').textContent = sys.cpu + '%';
          document.getElementById('cpuBar').style.width = sys.cpu + '%';
          document.getElementById('cpuBar').className = cpu > 80 ? 'progress-fill bg-red-500' : cpu > 50 ? 'progress-fill bg-yellow-500' : 'progress-fill bg-green-500';
          document.getElementById('memDisplay').textContent = sys.memoryPercent + '%';
          document.getElementById('memBar').style.width = sys.memoryPercent + '%';
          document.getElementById('memBar').className = mem > 80 ? 'progress-fill bg-red-500' : 'progress-fill bg-blue-500';
          document.getElementById('globalStatus').className = 'status-dot status-online';
          document.getElementById('systemStatus').textContent = sys.hostname || 'ç³»çµ±æ­£å¸¸';
        }
        
        // OpenClaw info
        if (dashData.openclaw) {
          const oc = dashData.openclaw;
          document.getElementById('openclawStatusDot').className = 'status-dot status-online';
          document.getElementById('openclawStatus').textContent = 'é‹ä½œä¸­';
          document.getElementById('openclawAgents').textContent = oc.agentCount + ' agents';
          document.getElementById('agentCount').textContent = oc.agentCount;
          document.getElementById('tgGroupCount').textContent = oc.telegramGroups || 0;
        }
        
        // Render agents from real data
        if (dashData.agents && dashData.agents.length) {
          renderAgents(dashData.agents);
        }
        
        // Render cron jobs from real data
        if (dashData.cronJobs && dashData.cronJobs.length) {
          renderCronJobs(dashData.cronJobs);
        }
        
        // Render sites with real check
        if (dashData.sites && dashData.sites.length) {
          renderSites(dashData.sites);
        }

        // Gemini API Usage
        if (dashData.geminiUsage) {
          renderGeminiUsage(dashData.geminiUsage);
        }

        // Data freshness
        if (dashData.generatedAt) {
          const genDate = new Date(dashData.generatedAt);
          document.getElementById('lastUpdate').textContent = genDate.toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });
        }

        // Version
        const ver = 'v2.0';
        document.getElementById('configVer').textContent = ver;
        document.getElementById('versionFooter').textContent = ver;
        
        // Week active hours (from cron jobs count * estimated)
        const cronCount = (dashData.cronJobs || []).filter(j => j.enabled).length;
        document.getElementById('weekActive').textContent = cronCount * 3;
        
        // Quality: based on error rate
        const errorJobs = (dashData.cronJobs || []).filter(j => j.consecutiveErrors > 0).length;
        const totalJobs = (dashData.cronJobs || []).length || 1;
        const quality = Math.round(100 - (errorJobs / totalJobs * 30));
        document.getElementById('qualityScore').textContent = quality;
        
      } catch (e) {
        console.error('Failed to load dashboard data:', e);
      }
    }
    
    // Render agents dynamically from dashboard-data.json
    function renderAgents(agentsList) {
      const container = document.querySelector('.grid.md\\:grid-cols-3.gap-4.mb-6');
      if (!container) return;
      
      const roleMap = {
        'sarah_agent': { role: 'PM', color: 'from-indigo-400 to-blue-500', desc: 'è² è²¬å°ˆæ¡ˆç®¡ç†èˆ‡å”èª¿' },
        'mars_agent': { role: 'Architect', color: 'from-orange-400 to-amber-500', desc: 'è² è²¬ç³»çµ±æ¶æ§‹èˆ‡ç¶²ç«™é–‹ç™¼' },
        'ryan_agent': { role: 'Lead Engineer', color: 'from-emerald-400 to-teal-500', desc: 'è² è²¬æŠ€è¡“æ±ºç­–èˆ‡å“è³ªæŠŠé—œ' }
      };
      
      container.innerHTML = agentsList.map(a => {
        const info = roleMap[a.id] || { role: 'Agent', color: 'from-gray-400 to-gray-500', desc: '' };
        return `
          <div class="glass rounded-xl p-5 animate-fade-in animate-delay-3 card-clickable" onclick="openAgentDetail('${a.id}')">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br ${info.color} flex items-center justify-center text-white font-bold">${a.name[0]}</div>
                <div>
                  <h3 class="font-semibold text-white">${a.name}</h3>
                  <p class="text-xs text-slate-400">${info.role}</p>
                </div>
              </div>
              <span class="status-dot status-online"></span>
            </div>
            <div class="text-xs text-slate-400">${a.model}</div>
            <div class="mt-2 text-xs text-indigo-400"><i class="fas fa-external-link-alt mr-1"></i>é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
          </div>
        `;
      }).join('');
    }
    
    // Render cron jobs dynamically
    function renderCronJobs(jobs) {
      const container = document.getElementById('scheduledJobs');
      if (!container) return;
      
      // Update count in header
      const header = container.closest('.glass')?.querySelector('h3');
      if (header) header.innerHTML = `<i class="fas fa-clock text-indigo-400 mr-2"></i>æ’ç¨‹ä»»å‹™ (${jobs.length})`;
      
      const colorCycle = [
        'from-cyan-400 to-blue-500', 'from-indigo-400 to-purple-500',
        'from-green-400 to-emerald-500', 'from-amber-400 to-orange-500',
        'from-purple-400 to-pink-500', 'from-red-400 to-pink-500'
      ];
      const emojiMap = { 'main': 'ğŸ”§', 'sarah_agent': 'S', 'mars_agent': 'M', 'ryan_agent': 'R' };
      
      container.innerHTML = jobs.map((job, i) => {
        const statusClass = job.lastStatus === 'ok' ? 'status-online' : job.lastStatus === 'error' ? 'status-offline' : 'status-checking';
        const statusText = job.lastStatus === 'ok' ? 'âœ…' : job.lastStatus === 'error' ? 'âŒ éŒ¯èª¤' : 'â³';
        const scheduleText = formatSchedule(job.schedule);
        const nextText = job.nextRunAt ? formatRelativeTime(new Date(job.nextRunAt)) : '--';
        
        return `
          <div class="glass-light rounded-xl p-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br ${colorCycle[i % colorCycle.length]} flex items-center justify-center text-white text-sm font-bold">${emojiMap[job.agentId] || 'âš¡'}</div>
                <div>
                  <div class="font-medium text-white">${job.name}</div>
                  <div class="text-xs text-slate-400">${scheduleText} â€¢ ${job.agentId}${!job.enabled ? ' â€¢ <span class="text-red-400">å·²åœç”¨</span>' : ''}</div>
                </div>
              </div>
              <div class="text-right">
                <span class="status-dot ${statusClass}"></span>
                <div class="text-xs ${job.lastStatus === 'error' ? 'text-red-400' : 'text-green-400'} mt-1">ä¸‹æ¬¡: ${nextText}</div>
                ${job.consecutiveErrors > 0 ? `<div class="text-xs text-red-400">é€£çºŒéŒ¯èª¤: ${job.consecutiveErrors}</div>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function formatSchedule(schedule) {
      if (!schedule) return '--';
      if (schedule.kind === 'cron') return `cron: ${schedule.expr}${schedule.tz ? ' (' + schedule.tz + ')' : ''}`;
      if (schedule.kind === 'every') {
        const hours = schedule.everyMs / 3600000;
        return hours >= 1 ? `æ¯ ${hours} å°æ™‚` : `æ¯ ${schedule.everyMs / 60000} åˆ†é˜`;
      }
      if (schedule.kind === 'at') return `ä¸€æ¬¡æ€§: ${new Date(schedule.at).toLocaleString('zh-TW')}`;
      return '--';
    }
    
    function formatRelativeTime(date) {
      const now = new Date();
      const diff = date - now;
      if (diff < 0) return 'å·²éæœŸ';
      const hours = Math.floor(diff / 3600000);
      const mins = Math.floor((diff % 3600000) / 60000);
      if (hours > 24) return date.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' }) + ' ' + date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Taipei' });
      if (hours > 0) return `${hours}h ${mins}m`;
      return `${mins}m`;
    }
    
    // Real site status check
    function renderSites(sites) {
      const container = document.getElementById('siteStatus');
      if (!container) return;
      
      // Add dashboard itself
      const allSites = [...sites];
      if (!allSites.find(s => s.url?.includes('vercel-dashboard-omega'))) {
        allSites.push({ name: 'Dashboard', url: 'https://vercel-dashboard-omega.vercel.app', status: 'active' });
      }
      
      container.innerHTML = allSites.map((site, i) => `
        <a href="${site.url || '#'}" target="_blank" rel="noopener" class="glass-light rounded-xl p-3 hover-lift block ${site.url ? 'cursor-pointer' : ''}">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-white">${site.name}</span>
            <span class="status-dot status-checking" id="site-status-${i}"></span>
          </div>
          <div class="text-xs text-slate-400" id="site-label-${i}">æª¢æŸ¥ä¸­...</div>
          ${site.url ? `<div class="text-xs text-indigo-400 mt-1 truncate"><i class="fas fa-external-link-alt mr-1"></i>${site.url.replace('https://', '')}</div>` : ''}
        </a>
      `).join('');
      
      // Actually check each site
      allSites.forEach((site, i) => {
        if (!site.url) {
          document.getElementById('site-status-' + i).className = 'status-dot status-dev';
          document.getElementById('site-label-' + i).textContent = 'ğŸ”§ é–‹ç™¼ä¸­';
          return;
        }
        
        const start = Date.now();
        fetch(site.url, { method: 'HEAD', mode: 'no-cors' })
          .then(() => {
            const ms = Date.now() - start;
            document.getElementById('site-status-' + i).className = 'status-dot status-online';
            document.getElementById('site-label-' + i).textContent = `ğŸŸ¢ ç·šä¸Š (${ms}ms)`;
            document.getElementById('site-label-' + i).className = 'text-xs text-green-400';
          })
          .catch(() => {
            document.getElementById('site-status-' + i).className = 'status-dot status-offline';
            document.getElementById('site-label-' + i).textContent = 'ğŸ”´ é›¢ç·š';
            document.getElementById('site-label-' + i).className = 'text-xs text-red-400';
          });
      });
    }
    
    function renderGeminiUsage(usage) {
      const today = usage.today || {};
      const limits = usage.limits || { rpd: 500, image_rpd: 50 };
      
      document.getElementById('geminiDate').textContent = new Date().toLocaleDateString('zh-TW');
      
      // RPD
      const rpd = today.total_requests || 0;
      const rpdLimit = limits.rpd || 500;
      const rpdPct = Math.min(100, Math.round(rpd / rpdLimit * 100));
      document.getElementById('geminiRpd').textContent = rpd;
      document.getElementById('geminiRpdLimit').textContent = rpdLimit;
      document.getElementById('geminiRpdBar').style.width = rpdPct + '%';
      document.getElementById('geminiRpdBar').className = `h-1.5 rounded-full transition-all ${rpdPct > 90 ? 'bg-red-400' : rpdPct > 70 ? 'bg-yellow-400' : 'bg-emerald-400'}`;
      document.getElementById('geminiRpdStatus').textContent = rpdPct + '%';
      document.getElementById('geminiRpdStatus').className = `text-xs font-mono ${rpdPct > 90 ? 'text-red-400' : rpdPct > 70 ? 'text-yellow-400' : 'text-emerald-400'}`;
      
      // Images
      const img = today.image_requests || 0;
      const imgLimit = limits.image_rpd || 50;
      const imgPct = Math.min(100, Math.round(img / imgLimit * 100));
      document.getElementById('geminiImg').textContent = img;
      document.getElementById('geminiImgLimit').textContent = imgLimit;
      document.getElementById('geminiImgBar').style.width = imgPct + '%';
      document.getElementById('geminiImgBar').className = `h-1.5 rounded-full transition-all ${imgPct > 90 ? 'bg-red-400' : imgPct > 70 ? 'bg-yellow-400' : 'bg-blue-400'}`;
      document.getElementById('geminiImgStatus').textContent = imgPct + '%';
      document.getElementById('geminiImgStatus').className = `text-xs font-mono ${imgPct > 90 ? 'text-red-400' : imgPct > 70 ? 'text-yellow-400' : 'text-blue-400'}`;
      
      // Text & Errors
      document.getElementById('geminiText').textContent = today.text_requests || 0;
      const errors = today.errors || 0;
      document.getElementById('geminiErrors').innerHTML = `<span class="${errors > 0 ? 'text-red-400' : 'text-white'}">${errors}</span>`;
      
      // 7-day history chart
      const history = usage.history || {};
      const historyEl = document.getElementById('geminiHistory');
      const days = Object.entries(history);
      if (days.length === 0) {
        historyEl.innerHTML = '<div class="text-xs text-slate-500 w-full text-center">å°šç„¡æ­·å²è³‡æ–™</div>';
        return;
      }
      const maxReq = Math.max(...days.map(([,v]) => v.requests || v.total_requests || 1));
      historyEl.innerHTML = days.map(([date, val]) => {
        const reqs = val.requests || val.total_requests || 0;
        const imgs = val.images || val.image_requests || 0;
        const h = Math.max(4, Math.round((reqs / maxReq) * 56));
        const day = date.slice(5);
        return `<div class="flex-1 flex flex-col items-center gap-1">
          <div class="w-full bg-emerald-500/60 rounded-t" style="height:${h}px" title="${date}: ${reqs}æ¬¡ (${imgs}å¼µåœ–)"></div>
          <span class="text-[10px] text-slate-500">${day}</span>
        </div>`;
      }).join('');
    }

    function getEmoji(name) {
      if (name.includes('å­”é›€') || name.includes('Aquarium')) return 'ğŸŸ';
      if (name.includes('SEO') || name.includes('éƒ¨è½æ ¼')) return 'ğŸ“';
      if (name.includes('Agent')) return 'ğŸ¤–';
      if (name.includes('ETF')) return 'ğŸ“Š';
      if (name.includes('åœ˜éšŠ')) return 'ğŸ‘¥';
      return 'ğŸ“';
    }
    
    function filterProjects(status) {
      currentFilter = status;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === status);
      });
      renderProjects();
    }
    
    function openProject(url) {
      if (url && url !== '#') window.open(url);
    }
    
    // Clock
    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString('zh-TW', { hour12: false, timeZone: 'Asia/Taipei' });
      document.getElementById('fullDate').textContent = now.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Taipei' });
      updateLunarDate(now);
    }
    function updateLunarDate(date) {
      const lunarDays = ['', 'åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå', 'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå', 'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
      const year = date.getFullYear();
      const start = new Date(year, 0, 29);
      const diff = Math.floor((date - start) / (1000 * 60 * 60 * 24));
      document.getElementById('lunarDate').textContent = lunarDays[Math.min(diff % 30 + 1, 30)] || 'åˆä¸€';
    }
    setInterval(updateClock, 1000);
    updateClock();
    
    // Theme
    function toggleTheme() {
      const html = document.documentElement;
      const btn = document.getElementById('themeBtn');
      if (html.getAttribute('data-theme') === 'dark') {
        html.setAttribute('data-theme', 'light');
        btn.textContent = 'â˜€ï¸';
      } else {
        html.setAttribute('data-theme', 'dark');
        btn.textContent = 'ğŸŒ™';
      }
    }
    function autoNightMode() {
      const hour = new Date().getHours();
      const html = document.documentElement;
      const btn = document.getElementById('themeBtn');
      if (hour >= 18 || hour < 6) {
        html.setAttribute('data-theme', 'dark');
        btn.textContent = 'ğŸŒ™';
      }
    }
    autoNightMode();
    
    // Weather & Crypto with enhanced visualization
    async function updateWeather() {
      try {
        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.6273&longitude=120.3014&current_weather=true');
        const data = await res.json();
        const temp = data.current_weather.temperature;
        const code = data.current_weather.weathercode;
        const icons = { 0: 'â˜€ï¸', 1: 'ğŸŒ¤ï¸', 2: 'â›…', 3: 'â˜ï¸', 45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸', 51: 'ğŸŒ§ï¸', 61: 'ğŸŒ§ï¸', 71: 'ğŸŒ¨ï¸', 80: 'ğŸŒ§ï¸', 95: 'â›ˆï¸' };
        document.getElementById('weather-temp').textContent = temp + 'Â°C';
        document.getElementById('weatherIcon').textContent = icons[code] || 'â›…';
        document.getElementById('weather-desc').textContent = temp > 25 ? 'æº«æš–' : temp > 18 ? 'èˆ’é©' : 'æ¶¼çˆ½';
      } catch (e) { 
        document.getElementById('weather-temp').textContent = '22Â°C'; 
        document.getElementById('weatherIcon').textContent = 'â›…';
      }
    }
    
    let btcPrevPrice = 0;
    async function updateCrypto() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
        const data = await res.json();
        const price = data.bitcoin.usd;
        const change = data.bitcoin.usd_24h_change;
        document.getElementById('crypto-btc').textContent = '$' + price.toLocaleString();
        
        const changeEl = document.getElementById('crypto-change');
        if (change !== undefined) {
          const sign = change >= 0 ? '+' : '';
          changeEl.textContent = sign + change.toFixed(2) + '% (24h)';
          changeEl.className = 'text-xs mt-1 ' + (change >= 0 ? 'price-up' : 'price-down');
        }
      } catch (e) { 
        document.getElementById('crypto-btc').textContent = '$97,500'; 
        document.getElementById('crypto-change').textContent = '+2.5% (24h)';
      }
    }
    updateWeather();
    updateCrypto();
    setInterval(() => { updateWeather(); updateCrypto(); }, 60000);
    
    // Website status check is now handled by renderSites() in loadConfig
    function checkAllStatus() { /* handled by renderSites */ }
    
    // Command Palette
    function openCommandPalette() { 
      document.getElementById('commandModal').classList.remove('hidden'); 
      document.getElementById('commandModal').classList.add('flex'); 
    }
    function closeCommandPalette() { 
      document.getElementById('commandModal').classList.add('hidden'); 
      document.getElementById('commandModal').classList.remove('flex'); 
    }
    function sendMessage() {
      const agent = document.getElementById('agentSelect').value;
      const msg = document.getElementById('messageInput').value;
      if (msg.trim()) {
        alert('âœ… è¨Šæ¯å·²å‚³é€çµ¦ ' + agent.toUpperCase() + ':\n' + msg);
        document.getElementById('messageInput').value = '';
        closeCommandPalette();
      }
    }
    
    // Task functions removed
    
    // Agent Modal - uses real data from dashData
    function openAgentDetail(agentId) {
      const agent = (dashData.agents || []).find(a => a.id === agentId);
      if (!agent) return;
      
      const roleMap = {
        'sarah_agent': { role: 'PM', color: 'from-indigo-400 to-blue-500', desc: 'è² è²¬å°ˆæ¡ˆç®¡ç†èˆ‡å”èª¿' },
        'mars_agent': { role: 'Architect', color: 'from-orange-400 to-amber-500', desc: 'è² è²¬ç³»çµ±æ¶æ§‹èˆ‡ç¶²ç«™é–‹ç™¼' },
        'ryan_agent': { role: 'Lead Engineer', color: 'from-emerald-400 to-teal-500', desc: 'è² è²¬æŠ€è¡“æ±ºç­–èˆ‡å“è³ªæŠŠé—œ' }
      };
      const info = roleMap[agentId] || { role: 'Agent', color: 'from-gray-400 to-gray-500', desc: agent.role };
      
      // Find cron jobs assigned to this agent
      const agentJobs = (dashData.cronJobs || []).filter(j => j.agentId === agentId);
      
      document.getElementById('agentModalTitle').textContent = agent.name + ' - ' + info.role;
      
      document.getElementById('agentModalContent').innerHTML = `
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br ${info.color} flex items-center justify-center text-white text-2xl font-bold">${agent.name[0]}</div>
          <div>
            <div class="text-xl font-semibold text-white">${agent.name}</div>
            <div class="text-sm text-slate-400">${info.role}</div>
            <div class="flex items-center gap-2 mt-1">
              <span class="status-dot status-online"></span>
              <span class="text-sm text-green-400">Online</span>
            </div>
          </div>
        </div>
        <div class="glass-light rounded-xl p-4">
          <div class="text-xs text-slate-400 mb-1">æ¨¡å‹</div>
          <div class="text-white">${agent.model}</div>
        </div>
        <div class="glass-light rounded-xl p-4">
          <div class="text-xs text-slate-400 mb-1">è·è²¬</div>
          <div class="text-white">${info.desc}</div>
        </div>
        ${agentJobs.length ? `
        <div class="glass-light rounded-xl p-4">
          <div class="text-xs text-slate-400 mb-2">æ’ç¨‹ä»»å‹™ (${agentJobs.length})</div>
          <div class="space-y-1">
            ${agentJobs.map(j => `
              <div class="flex items-center justify-between">
                <span class="text-sm text-white">${j.name}</span>
                <span class="text-xs ${j.lastStatus === 'ok' ? 'text-green-400' : 'text-red-400'}">${j.lastStatus === 'ok' ? 'âœ…' : 'âŒ'}</span>
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}
      `;
      
      document.getElementById('agentModal').classList.remove('hidden');
      document.getElementById('agentModal').classList.add('flex');
    }
    function closeAgentModal() {
      document.getElementById('agentModal').classList.add('hidden');
      document.getElementById('agentModal').classList.remove('flex');
    }
    
    // Detail modals - open external links
    function openWeatherDetail() { window.open('https://www.cwb.gov.tw/V8/C/W/County/County.html?CID=64', '_blank'); }
    function openCryptoDetail() { window.open('https://www.coingecko.com/en/coins/bitcoin', '_blank'); }
    function openOpenClawStatus() { window.open('https://docs.openclaw.ai', '_blank'); }
    function openSystemDetail() { /* local only - no action on Vercel */ }
    
    // Feedback functions
    function openFeedback() {
      document.getElementById('feedbackModal').classList.remove('hidden');
      document.getElementById('feedbackModal').classList.add('flex');
    }
    function closeFeedback() {
      document.getElementById('feedbackModal').classList.add('hidden');
      document.getElementById('feedbackModal').classList.remove('flex');
      document.getElementById('feedbackText').value = '';
    }
    function submitFeedback() {
      const type = document.getElementById('feedbackType').value;
      const text = document.getElementById('feedbackText').value;
      if (!text.trim()) {
        alert('è«‹è¼¸å…¥åé¥‹å…§å®¹');
        return;
      }
      
      // Store feedback locally (in real app, send to server)
      const feedback = { type, text, time: new Date().toISOString() };
      const feedbacks = JSON.parse(localStorage.getItem('dashboard_feedbacks') || '[]');
      feedbacks.push(feedback);
      localStorage.setItem('dashboard_feedbacks', JSON.stringify(feedbacks));
      
      alert('âœ… æ„Ÿè¬æ‚¨çš„åé¥‹ï¼\né¡å‹: ' + type + '\nå…§å®¹: ' + text.substring(0, 50) + '...');
      closeFeedback();
    }
    
    // Update notification - disabled (no random)
    function dismissUpdate() {
      document.getElementById('updateToast').classList.add('hidden');
    }
    
    // Error handling
    window.onerror = function(msg, url, line, col, error) {
      console.error('Error:', msg, 'at', line);
      // In real app, send to Sentry
      return false;
    };
    
    // No random update check
    
    // Refresh all
    function refreshAll() {
      location.reload();
    }
    
    // Refresh jobs - reload from data
    function refreshJobs() {
      if (dashData.cronJobs) renderCronJobs(dashData.cronJobs);
    }
    
    // Utils
    function copyToClipboard(text) { navigator.clipboard.writeText(text).catch(() => {}); }
    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-TW');
    
    // PWA
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js').catch(() => {}); }
    
    // Init
    loadConfig();
  </script>
</body>
</html>
<!-- v1.3 -->
